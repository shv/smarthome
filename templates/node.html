{% extends "wrapper.html" %}

{% block content %}
    <div id='node' style="font-weight: bold">Node {{ node_id }}. </div>
    <h2 style="text-align: center">Lamps</h2>
    <div id="lamps" style="font-size: 30pt;text-align: center"></div>
    <h2 style="text-align: center">Sensors</h2>
    <div id="sensors" style="text-align: center"></div>
    <script>
        $.get("/api/nodes/{{ node_id }}",
            function (data, status) {
                console.log("Data: " + data + "\nStatus: " + status);
                var node_el = document.getElementById('node')
                var content = document.createTextNode(
                    "ID: " + data["id"] + ", is_active: " + data["is_active"] + ", online: "
                )
                var node_online_el = document.createElement('span')
                var node_online_content = document.createTextNode(data["is_online"])
                node_online_el.appendChild(node_online_content)
                node_online_el.id = "node-online-" + data["id"]
                node_el.appendChild(content)
                node_el.appendChild(node_online_el)
            }
        );

        // $.get("/api/nodes/{{ node_id }}/current-values",
        //     function (data, status) {
        //         console.log("Data: " + data + "\nStatus: " + status);
        //         var nodes_el = document.getElementById('values')
        //         data["data"].forEach(function (currentValue, index, arr) {
        //             console.log(currentValue)
        //             var node_el = document.createElement('li')
        //             var value_label_el = document.createElement('span')
        //             var value_label_content = document.createTextNode(
        //                 "ID: " + currentValue["id"] + ", " + currentValue["name"] + ": "
        //             )
        //             value_label_el.appendChild(value_label_content)
        //             var value_value_el = document.createElement('span')
        //             var value_value_content = document.createTextNode(currentValue["value"])
        //             value_value_el.appendChild(value_value_content)
        //             value_value_el.id = "current-value-" + currentValue["id"]
        //             node_el.appendChild(value_label_el)
        //             node_el.appendChild(value_value_el)
        //             nodes_el.appendChild(node_el)
        //         });
        //     }
        // );
        $.get("/api/nodes/{{ node_id }}/lamps",
            function (data, status) {
                console.log("Data: " + data + "\nStatus: " + status);
                var lamps_el = document.getElementById('lamps')
                data["data"].forEach(function (currentValue, index, arr) {
                    console.log(currentValue)
                    var lamp_div_el = document.createElement('div')
                    lamp_div_el.style.margin = "30pt"
                    var lamp_input_el = document.createElement('input')
                    lamp_input_el.type = "checkbox";
                    lamp_input_el.style.width = "20pt"
                    lamp_input_el.style.height = "20pt"
                    lamp_input_el.style.margin = "10pt"
                    lamp_input_el.dataset.id = currentValue["id"];
                    lamp_input_el.id = "lamp-" + currentValue["id"];
                    lamp_input_el.onchange = sendMessage;
                    if (currentValue["value"]) {
                        lamp_input_el.checked = true
                    }
                    var lamp_label_el = document.createElement('label')
                    lamp_label_el.htmlFor = "lamp-" + currentValue["id"];
                    var lamp_label_text = document.createTextNode(
                        currentValue["id"] + ". " + currentValue["name"] + ", v: "
                    )
                    var lamp_value_el = document.createElement('span')
                    lamp_value_el.id = "lamp-value-" + currentValue["id"];
                    var lamp_value_text = document.createTextNode(currentValue["value"])
                    lamp_value_el.appendChild(lamp_value_text)
                    lamp_label_el.appendChild(lamp_label_text)
                    lamp_div_el.appendChild(lamp_input_el)
                    lamp_div_el.appendChild(lamp_label_el)
                    lamp_div_el.appendChild(lamp_value_el)
                    lamps_el.appendChild(lamp_div_el)
                });
            }
        );
        $.get("/api/nodes/{{ node_id }}/sensors",
            function (data, status) {
                console.log("Data: " + data + "\nStatus: " + status);
                var sensors_el = document.getElementById('sensors')
                data["data"].forEach(function (currentValue, index, arr) {
                    console.log(currentValue)
                    var sensor_div_el = document.createElement('div')
                    var sensor_div_text = document.createTextNode(
                        currentValue["id"] + ". " + currentValue["name"] + ": "
                    )
                    var sensor_value_el = document.createElement('span')
                    sensor_value_el.id = "sensor-value-" + currentValue["id"];
                    var sensor_value_text = document.createTextNode(currentValue["value"])
                    sensor_value_el.appendChild(sensor_value_text)
                    sensor_div_el.appendChild(sensor_div_text)
                    sensor_div_el.appendChild(sensor_value_el)
                    sensors_el.appendChild(sensor_div_el)
                });
            }
        );
        function sendMessage(event) {
            var obj = this;
            console.log(obj)
            ws.send(JSON.stringify({
                "request_id": "1",
                "action": "send_lamps_state_to_nodes",
                "data": {"lamps": [{"id": obj.dataset.id, "value": obj.checked?1:0}]}
            }))
            event.preventDefault()
        }

    </script>
{% endblock %}
